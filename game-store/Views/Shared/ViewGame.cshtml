@model GameViewModel

@inject SignInManager<GameStoreUser> SignInManager
@inject UserManager<GameStoreUser> UserManager

@{
    var user = await UserManager.GetUserAsync(User);
    var leveledComments = Model.LeveledComments;

    string imgDataUrl;
    if (Model.Image != null && Model.Image.Length != 0)
    {
        var gameImage = Convert.ToBase64String(Model.Image);
        imgDataUrl = string.Format("data:image/jpg;base64,{0}", gameImage);
    }
    else
    {
        imgDataUrl = "/img/default-game-image.jpeg";
    }
}


<style>
    .comment-form,
    .comments {
        margin-top: 20px;
    }

    .comment-buttons {
        margin-top: 10px;
    }

    .hidden {
        display: none;
    }
</style>

<!-- Page section -->
<section class="page-section single-blog-page spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <div class="blog-thumb set-bg" data-setbg="@imgDataUrl">
                    @{
                        string genresAsString = "";
                        @foreach (var genre in Model.Genres)
                        {
                            if (string.IsNullOrEmpty(genresAsString))
                            {
                                genresAsString += genre.GetAttribute<DisplayAttribute>().Name;
                            }
                            else
                            {
                                genresAsString += " / " + genre.GetAttribute<DisplayAttribute>().Name;
                            }
                        }
                    }
                    @if (!string.IsNullOrEmpty(genresAsString))
                    {
                        <div class="cata racing">@genresAsString</div>
                    }
                </div>
                <div class="blog-content">
                    <h3>@Model.Title</h3>
                    <a href="" class="meta-comment">3 comment</a>
                    <p>@Model.Description</p>
                    <form asp-action="EditGameData" asp-controller="Game" method="post">
                        <input type="hidden" asp-for="Id" name="gameId" />
                        <button class="btn btn-primary btn-sm">
                            Edit data
                        </button>
                    </form>
                    <form asp-action="DeleteGame" asp-controller="Game" method="post">
                        <input type="hidden" asp-for="Id" name="gameId" />
                        <button class="btn btn-danger btn-sm" data-bs-toggle="modal"
                                data-bs-target="#removeGameModal" type="button">
                            Delete game
                        </button>
                        <dlg id="removeGameModal" title="Remove game">
                            Are you sure to want to completely remove this game?
                        </dlg>
                    </form>
                </div>
                <div class="comment-warp">
                    <form id="commentForm">
                        <input type="hidden" name="gameId" value="@(Model.Id)" />
                        <input type="hidden" name="userId" value="@(user?.Id)" />
                        <input type="hidden" name="parrentId" value="@null" />
                    </form>
                    <button class="comment-button" onclick="beginCommentEvent('Main')">Comment</button>
                    <div class="comment-form hidden" id="commentForm@("Main")">
                        <textarea id="commentText@("Main")" placeholder="Enter your comment (max 600 characters)"></textarea>
                        <div class="comment-buttons">
                            <button id="comment-save" onclick="addCommentEvent('@(user?.UserName)', 'Main', '-1')">Save</button>
                            <button id="comment-cancel" onclick="cancelCommentEvent('@("Main")')">Cancel</button>
                        </div>
                    </div>
                    <h4 class="comment-title">Coments</h4>
                    <ul class="comment-list">
                        @for (var i = 0; i < leveledComments.Count; ++i)
                        {
                            var currentComment = leveledComments[i];

                            <li>
                                <div class="comment">
                                    <div class="comment-content">
                                        <h5>@(user?.UserName) <span>@(currentComment.DateTime)</span></h5>
                                        <p>@(currentComment.Text)</p>
                                        <button type="button" class="comment-button btn btn-link" onclick="beginCommentEvent('@(currentComment.Id)')">Reply</button>
                                        <div class="comment-form hidden" id="commentForm@(currentComment.Id)">
                                            <textarea id="commentText@(currentComment.Id)" placeholder="Enter your comment (max 600 characters)"></textarea>
                                            <div class="comment-buttons">
                                                <button id="comment-save" onclick="addCommentEvent('@(user?.UserName)', '@(currentComment.Id)', '@i')">Save</button>
                                                <button id="comment-cancel" onclick="cancelCommentEvent('@(currentComment.Id)')">Cancel</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        }
                        
                        @*<li>
                            <div class="comment">
                                <div class="comment-content">
                                    <h5>James Smith <span>June 21, 2018</span></h5>
                                    <p>Donec venenatis at eros sit amet aliquam. Donec vel orci efficitur, dictum nisl vitae, scelerisque nibh. Curabitur eget ipsum pulvinar nunc gravida interdum. </p>
                                    <a href="" class="reply">Reply</a>
                                </div>
                            </div>
                        </li>*@
                    </ul>

                    @*<div class="post-comments">
                        <div class="row">

                            <div class="media">
                                <!-- first comment -->
                                @for (var i = 0; i < leveledComments.Count; ++i)
                                {
                                    <div class="media-heading">
                                        <span class="label label-info">@(leveledComments[i].User.UserName)</span>
                                        @(leveledComments[i].DateTime)
                                    </div>

                                    <div class="panel-collapse collapse in" id="collapseOne">


                                        <div class="media-body">
                                            <p>@(leveledComments[i].Text)</p>
                                            <div class="comment-meta">
                                                <span><a href="#">delete</a></span>
                                                <span>
                                                    <a class="" role="button" data-toggle="collapse" href="#replyCommentT" aria-expanded="false" aria-controls="collapseExample">reply</a>
                                                </span>
                                                <div class="collapse" id="replyCommentT">
                                                    <form id="innerCommentForm">
                                                        <input type="hidden" name="gameId" value="@Model.Id" />
                                                        <input type="hidden" name="userId" value="@user?.Id" />
                                                        <input type="hidden" name="parrentId" value="@(leveledComments[i].ParentId)" />

                                                    </form>
                                                    <button class="comment-button" onclick="beginCommentEvent()">Comment</button>
                                                    <partial name="_CommentForm" model="@(leveledComments[i].Id)" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>*@
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Page section end -->